name: Run benchmark
on:
  workflow_dispatch:
    inputs:
      scenario_limit:
        description: "Number of scenarios to run"
        required: false
        default: ""
      output_dir:
        description: "Output directory for benchmark files"
        required: false
        default: "benchmark-output"

jobs:
  run-benchmark:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Setup bun
        uses: oven-sh/setup-bun@v2
        with:
          bun-version: latest
      - name: Install dependencies
        run: bun install --frozen-lockfile
      - name: Run benchmark
        run: |
          mkdir -p "${{ inputs.output_dir }}"
          args=(bun scripts/run-benchmark --output-dir "${{ inputs.output_dir }}")
          if [[ -n "${{ inputs.scenario_limit }}" && "${{ inputs.scenario_limit }}" =~ ^[1-9][0-9]*$ ]]; then
            args+=(--scenario-limit "${{ inputs.scenario_limit }}")
          fi
          "${args[@]}"
      - name: Upload benchmark files
        uses: actions/upload-artifact@v4
        with:
          name: benchmark-output
          path: ${{ inputs.output_dir }}
          if-no-files-found: error
